---
import { Icon } from "astro-icon/components";
import Button from "@/components/Button.astro";
---

<nav class="nav" aria-label="Main navigation" aria-hidden="true">
  <ul role="menubar">
    <li class="li" role="none">
      <a class="a" href="/" role="menuitem">
        <Icon name="mdi:home-circle-outline" />
        <div>
          <div class="en">About the Church</div>
          <div class="ja">教会について</div>
        </div>
      </a>
    </li>

    <li class="li" role="none">
      <a class="a" href="/specials/list/1" role="menuitem">
        <Icon name="mdi:event-note" />
        <div>
          <div class="en">Event Information</div>
          <div class="ja">イベントのご案内</div>
        </div>
      </a>
    </li>

    <li class="li" role="none">
      <a class="a" href="/access" role="menuitem">
        <Icon name="mdi:train-car" />
        <div>
          <div class="en">Access</div>
          <div class="ja">アクセス</div>
        </div>
      </a>
    </li>

    <li class="li" role="none">
      <a class="a" href="/faq" role="menuitem">
        <Icon name="mdi:comment-question-outline" />
        <div>
          <div class="en">FAQ</div>
          <div class="ja">よくある質問</div>
        </div>
      </a>
    </li>

    <li class="li" role="none">
      <a class="a" href="/contact" role="menuitem">
        <Icon name="mdi:invoice-text-send-outline" />
        <div>
          <div class="en">Contact Us</div>
          <div class="ja">お問い合わせ</div>
        </div>
      </a>
    </li>
  </ul>

  <div class="close">
    <Button aria-label="Close menu">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="svg" aria-hidden="true">
        <path
          d="M12.0007 10.5865L16.9504 5.63672L18.3646 7.05093L13.4149 12.0007L18.3646 16.9504L16.9504 18.3646L12.0007 13.4149L7.05093 18.3646L5.63672 16.9504L10.5865 12.0007L5.63672 7.05093L7.05093 5.63672L12.0007 10.5865Z"
        ></path>
      </svg>
    </Button>
  </div>
</nav>

<div class="menu">
  <Button aria-label="Open menu" aria-expanded="false" aria-controls="nav-menu">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="svg" aria-hidden="true">
      <path d="M4 6H20V8H4V8Z M4 16H20V18H4V14Z"></path>
    </svg>
  </Button>
</div>

<style>
  .nav {
    align-items: center;
    background: var(--color-background);
    color: var(--color-text);
    display: flex;
    inset: 0;
    justify-content: center;
    opacity: 0;
    overflow-y: scroll;
    position: fixed;
    transform: scale(0);
    transition:
      opacity 0.5s ease-out,
      transform 0s 0.5s;
    z-index: 1111;
  }

  .nav-active {
    opacity: 1;
    transform: scale(1);
    transition: 0s;
  }

  .li {
    margin: 0 0 2em;
    opacity: 0;
    transform: translateY(-20px);
    transition:
      opacity 0.3s,
      transform 0s 0.5s;
  }

  .li:nth-child(1) {
    --n: 1;
  }

  .li:nth-child(2) {
    --n: 2;
  }

  .li:nth-child(3) {
    --n: 3;
  }

  .li:nth-child(4) {
    --n: 4;
  }

  .li:nth-child(5) {
    --n: 5;
  }

  .nav-active .li {
    opacity: 1;
    transform: translateY(0);
    transition: 0.3s calc(var(--n) * 0.05s) ease-out;
  }

  .a {
    align-items: center;
    display: flex;
    gap: 0.5em;
    line-height: 1.2;
  }

  [data-icon] {
    height: 2em;
    width: 2em;
  }

  .en {
    font-family: Georgia, "Times New Roman", Times, serif;
    font-size: 125%;
  }

  .ja {
    letter-spacing: 0.05em;
  }

  .close,
  .menu {
    font-size: 0;
    height: 24px;
    padding: 8px;
    right: 10px;
    top: 10px;
    width: 24px;
  }

  .close {
    position: absolute;
  }

  .menu {
    position: fixed;
    transition: opacity 0.4s 0.1s;
    z-index: 11;
  }

  .nav-active + .menu {
    opacity: 0;
  }

  .svg {
    fill: currentColor;
  }
</style>

<script>
  const nav = document.querySelector(".nav") as HTMLElement;
  const menu = document.querySelector(".menu") as HTMLElement;
  const menuButton = menu?.querySelector("button") as HTMLButtonElement;
  const closeButton = nav?.querySelector(".close button") as HTMLButtonElement;

  function openMenu() {
    nav?.classList.add("nav-active");
    document.body.classList.add("nav-active");
    menuButton.setAttribute("aria-expanded", "true");
    nav?.setAttribute("aria-hidden", "false");
  }

  function closeMenu() {
    nav?.classList.remove("nav-active");
    document.body.classList.remove("nav-active");
    menuButton.setAttribute("aria-expanded", "false");
    nav?.setAttribute("aria-hidden", "true");
  }

  menuButton?.addEventListener("click", openMenu);
  closeButton?.addEventListener("click", closeMenu);

  // Close menu when clicking on a link
  nav?.querySelectorAll("a").forEach((link) => {
    link.addEventListener("click", closeMenu);
  });

  // Close menu on Escape key
  document.addEventListener("keydown", (event) => {
    if (event.key === "Escape" && nav?.classList.contains("nav-active")) {
      closeMenu();
    }
  });
</script>
